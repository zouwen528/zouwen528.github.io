---
title: 跨域
createTime: 2025/04/07 10:50:37
permalink: /blog/5c6mbcvj/
tags:
  - 浏览器
  - JavaScript
---

## 跨域解决方案：
    - CORS（跨域资源共享）
    - JSONP（JSON with Padding）
    - nginx 反向代理

## 同源策略：
    - 协议相同
    - 域名相同
    - 端口号相同

## 简单请求：
    - 只允许 GET、HEAD、POST 三个请求方法
    - 请求头中不能包含自定义的请求头
    - Content-Type 只能是 application/x-www-form-urlencoded、multipart/form-data、text/plain

    - 允许跨域请求的响应头中必须包含 Access-Control-Allow-Origin
    - Access-Control-Allow-Origin：允许跨域请求的源
    - Access-Control-Allow-Origin: *：允许所有源的跨域请求
    - Access-Control-Allow-Origin: http://example.com：只允许 http://example.com 的跨域请求


## 复杂请求：
    - 除了简单请求以外的请求
    - 需要预检请求（preflight request）  即 OPTIONS 请求
    - 如果服务器允许跨域请求，则返回 200 OK，并在响应头中包含 Access-Control-Allow-Origin 和 Access-Control-Allow-Methods 等字段
    - 如果有自定义Header, 则需要 Access-Control-Allow-Headers
    - Access-Control-Allow-Origin：允许跨域请求的源
    - Access-Control-Allow-Methods：允许的请求方法
    - Access-Control-Allow-Headers：允许的请求头
    - Access-Control-Max-Age：预检请求的有效期 预检请求的有效期内，浏览器不会再次发送预检请求
    - Access-Control-Allow-Credentials：是否允许携带凭证
    - Access-Control-Expose-Headers：允许浏览器访问的响应头

## 携带Cookie：
    - 同源请求会自动携带Cookie
    - 跨域请求需要设置 withCredentials 为 true（XMLHttpRequest） || credentials: 'include'（fetch）
        - 响应头中必须包含 Access-Control-Allow-Credentials: true
        - 允许跨域请求的响应头中必须包含 Access-Control-Allow-Origin，不能是 *
